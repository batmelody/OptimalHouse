function [Error, Transform_matrix] = LMformirror(Y_pred, Y_gt)
%%  sym variable process
% syms x1 x2 x3 x4 x5 x6 x7 x8 x9 x y z x_ y_ z_
% Fx = @(x,x1,x2,x3,x4,x5,x6,x7,x8,x9,x_,y,y_,z,z_) abs(x*x1 - x_ + x2*y + x3*z)^2 + abs(x*x4 - y_ + x5*y + x6*z)^2 + abs(x*x7 - z_ + x8*y + x9*z)^2;  %fx = ||PX - X_label||2
% Jx = [ 2*x*abs(x*x1 - x_ + x2*y + x3*z)*sign(x*x1 - x_ + x2*y + x3*z), 2*y*abs(x*x1 - x_ + x2*y + x3*z)*sign(x*x1 - x_ + x2*y + x3*z),...
%     2*z*abs(x*x1 - x_ + x2*y + x3*z)*sign(x*x1 - x_ + x2*y + x3*z), 2*x*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x4 - y_ + x5*y + x6*z),...
%     2*y*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x4 - y_ + x5*y + x6*z), 2*z*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x4 - y_ + x5*y + x6*z),...
%     2*x*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z),...
%     2*y*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z), 2*z*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z)];  % Jacobian matrix of f
% Ax = [                            4*x*abs(x*x1 - x_ + x2*y + x3*z)^2*sign(x*x1 - x_ + x2*y + x3*z)*conj(x)*conj(sign(x*x1 - x_ + x2*y + x3*z)),                            4*y*abs(x*x1 - x_ + x2*y + x3*z)^2*sign(x*x1 - x_ + x2*y + x3*z)*conj(x)*conj(sign(x*x1 - x_ + x2*y + x3*z)),                            4*z*abs(x*x1 - x_ + x2*y + x3*z)^2*sign(x*x1 - x_ + x2*y + x3*z)*conj(x)*conj(sign(x*x1 - x_ + x2*y + x3*z)), 4*x*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x4 - y_ + x5*y + x6*z)*conj(x)*conj(sign(x*x1 - x_ + x2*y + x3*z)), 4*y*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x4 - y_ + x5*y + x6*z)*conj(x)*conj(sign(x*x1 - x_ + x2*y + x3*z)), 4*z*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x4 - y_ + x5*y + x6*z)*conj(x)*conj(sign(x*x1 - x_ + x2*y + x3*z)), 4*x*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z)*conj(x)*conj(sign(x*x1 - x_ + x2*y + x3*z)), 4*y*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z)*conj(x)*conj(sign(x*x1 - x_ + x2*y + x3*z)), 4*z*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z)*conj(x)*conj(sign(x*x1 - x_ + x2*y + x3*z));                            4*x*abs(x*x1 - x_ + x2*y + x3*z)^2*sign(x*x1 - x_ + x2*y + x3*z)*conj(y)*conj(sign(x*x1 - x_ + x2*y + x3*z)),                            4*y*abs(x*x1 - x_ + x2*y + x3*z)^2*sign(x*x1 - x_ + x2*y + x3*z)*conj(y)*conj(sign(x*x1 - x_ + x2*y + x3*z)),                            4*z*abs(x*x1 - x_ + x2*y + x3*z)^2*sign(x*x1 - x_ + x2*y + x3*z)*conj(y)*conj(sign(x*x1 - x_ + x2*y + x3*z)), 4*x*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x4 - y_ + x5*y + x6*z)*conj(y)*conj(sign(x*x1 - x_ + x2*y + x3*z)), 4*y*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x4 - y_ + x5*y + x6*z)*conj(y)*conj(sign(x*x1 - x_ + x2*y + x3*z)), 4*z*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x4 - y_ + x5*y + x6*z)*conj(y)*conj(sign(x*x1 - x_ + x2*y + x3*z)), 4*x*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z)*conj(y)*conj(sign(x*x1 - x_ + x2*y + x3*z)), 4*y*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z)*conj(y)*conj(sign(x*x1 - x_ + x2*y + x3*z)), 4*z*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z)*conj(y)*conj(sign(x*x1 - x_ + x2*y + x3*z));                            4*x*abs(x*x1 - x_ + x2*y + x3*z)^2*sign(x*x1 - x_ + x2*y + x3*z)*conj(z)*conj(sign(x*x1 - x_ + x2*y + x3*z)),                            4*y*abs(x*x1 - x_ + x2*y + x3*z)^2*sign(x*x1 - x_ + x2*y + x3*z)*conj(z)*conj(sign(x*x1 - x_ + x2*y + x3*z)),                            4*z*abs(x*x1 - x_ + x2*y + x3*z)^2*sign(x*x1 - x_ + x2*y + x3*z)*conj(z)*conj(sign(x*x1 - x_ + x2*y + x3*z)), 4*x*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x4 - y_ + x5*y + x6*z)*conj(z)*conj(sign(x*x1 - x_ + x2*y + x3*z)), 4*y*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x4 - y_ + x5*y + x6*z)*conj(z)*conj(sign(x*x1 - x_ + x2*y + x3*z)), 4*z*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x4 - y_ + x5*y + x6*z)*conj(z)*conj(sign(x*x1 - x_ + x2*y + x3*z)), 4*x*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z)*conj(z)*conj(sign(x*x1 - x_ + x2*y + x3*z)), 4*y*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z)*conj(z)*conj(sign(x*x1 - x_ + x2*y + x3*z)), 4*z*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z)*conj(z)*conj(sign(x*x1 - x_ + x2*y + x3*z)); 4*x*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x1 - x_ + x2*y + x3*z)*conj(x), 4*y*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x1 - x_ + x2*y + x3*z)*conj(x), 4*z*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x1 - x_ + x2*y + x3*z)*conj(x),                            4*x*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)^2*sign(x*x4 - y_ + x5*y + x6*z)*conj(x),                            4*y*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)^2*sign(x*x4 - y_ + x5*y + x6*z)*conj(x),                            4*z*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)^2*sign(x*x4 - y_ + x5*y + x6*z)*conj(x), 4*x*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z)*conj(x), 4*y*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z)*conj(x), 4*z*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z)*conj(x); 4*x*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x1 - x_ + x2*y + x3*z)*conj(y), 4*y*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x1 - x_ + x2*y + x3*z)*conj(y), 4*z*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x1 - x_ + x2*y + x3*z)*conj(y),                            4*x*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)^2*sign(x*x4 - y_ + x5*y + x6*z)*conj(y),                            4*y*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)^2*sign(x*x4 - y_ + x5*y + x6*z)*conj(y),                            4*z*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)^2*sign(x*x4 - y_ + x5*y + x6*z)*conj(y), 4*x*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z)*conj(y), 4*y*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z)*conj(y), 4*z*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z)*conj(y); 4*x*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x1 - x_ + x2*y + x3*z)*conj(z), 4*y*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x1 - x_ + x2*y + x3*z)*conj(z), 4*z*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x4 - y_ + x5*y + x6*z)*sign(x*x1 - x_ + x2*y + x3*z)*conj(z),                            4*x*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)^2*sign(x*x4 - y_ + x5*y + x6*z)*conj(z),                            4*y*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)^2*sign(x*x4 - y_ + x5*y + x6*z)*conj(z),                            4*z*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)^2*sign(x*x4 - y_ + x5*y + x6*z)*conj(z), 4*x*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z)*conj(z), 4*y*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z)*conj(z), 4*z*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x7 - z_ + x8*y + x9*z)*conj(z); 4*x*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x1 - x_ + x2*y + x3*z)*conj(x), 4*y*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x1 - x_ + x2*y + x3*z)*conj(x), 4*z*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x1 - x_ + x2*y + x3*z)*conj(x), 4*x*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x4 - y_ + x5*y + x6*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x4 - y_ + x5*y + x6*z)*conj(x), 4*y*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x4 - y_ + x5*y + x6*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x4 - y_ + x5*y + x6*z)*conj(x), 4*z*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x4 - y_ + x5*y + x6*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x4 - y_ + x5*y + x6*z)*conj(x),                            4*x*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x7 - z_ + x8*y + x9*z)^2*sign(x*x7 - z_ + x8*y + x9*z)*conj(x),                            4*y*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x7 - z_ + x8*y + x9*z)^2*sign(x*x7 - z_ + x8*y + x9*z)*conj(x),                            4*z*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x7 - z_ + x8*y + x9*z)^2*sign(x*x7 - z_ + x8*y + x9*z)*conj(x); 4*x*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x1 - x_ + x2*y + x3*z)*conj(y), 4*y*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x1 - x_ + x2*y + x3*z)*conj(y), 4*z*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x1 - x_ + x2*y + x3*z)*conj(y), 4*x*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x4 - y_ + x5*y + x6*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x4 - y_ + x5*y + x6*z)*conj(y), 4*y*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x4 - y_ + x5*y + x6*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x4 - y_ + x5*y + x6*z)*conj(y), 4*z*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x4 - y_ + x5*y + x6*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x4 - y_ + x5*y + x6*z)*conj(y),                            4*x*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x7 - z_ + x8*y + x9*z)^2*sign(x*x7 - z_ + x8*y + x9*z)*conj(y),                            4*y*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x7 - z_ + x8*y + x9*z)^2*sign(x*x7 - z_ + x8*y + x9*z)*conj(y),                            4*z*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x7 - z_ + x8*y + x9*z)^2*sign(x*x7 - z_ + x8*y + x9*z)*conj(y); 4*x*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x1 - x_ + x2*y + x3*z)*conj(z), 4*y*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x1 - x_ + x2*y + x3*z)*conj(z), 4*z*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x1 - x_ + x2*y + x3*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x1 - x_ + x2*y + x3*z)*conj(z), 4*x*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x4 - y_ + x5*y + x6*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x4 - y_ + x5*y + x6*z)*conj(z), 4*y*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x4 - y_ + x5*y + x6*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x4 - y_ + x5*y + x6*z)*conj(z), 4*z*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x4 - y_ + x5*y + x6*z)*abs(x*x7 - z_ + x8*y + x9*z)*sign(x*x4 - y_ + x5*y + x6*z)*conj(z),                            4*x*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x7 - z_ + x8*y + x9*z)^2*sign(x*x7 - z_ + x8*y + x9*z)*conj(z),                            4*y*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x7 - z_ + x8*y + x9*z)^2*sign(x*x7 - z_ + x8*y + x9*z)*conj(z),                            4*z*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x7 - z_ + x8*y + x9*z)^2*sign(x*x7 - z_ + x8*y + x9*z)*conj(z)];  % Jacobian matrix of f %J'J
% 
% gx =  [2*abs(x*x1 - x_ + x2*y + x3*z)*conj(x)*conj(sign(x*x1 - x_ + x2*y + x3*z))*(abs(x*x1 - x_ + x2*y + x3*z)^2 + abs(x*x4 - y_ + x5*y + x6*z)^2 + abs(x*x7 - z_ + x8*y + x9*z)^2);
%  2*abs(x*x1 - x_ + x2*y + x3*z)*conj(y)*conj(sign(x*x1 - x_ + x2*y + x3*z))*(abs(x*x1 - x_ + x2*y + x3*z)^2 + abs(x*x4 - y_ + x5*y + x6*z)^2 + abs(x*x7 - z_ + x8*y + x9*z)^2);
%  2*abs(x*x1 - x_ + x2*y + x3*z)*conj(z)*conj(sign(x*x1 - x_ + x2*y + x3*z))*(abs(x*x1 - x_ + x2*y + x3*z)^2 + abs(x*x4 - y_ + x5*y + x6*z)^2 + abs(x*x7 - z_ + x8*y + x9*z)^2);
%  2*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)*conj(x)*(abs(x*x1 - x_ + x2*y + x3*z)^2 + abs(x*x4 - y_ + x5*y + x6*z)^2 + abs(x*x7 - z_ + x8*y + x9*z)^2);
%  2*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)*conj(y)*(abs(x*x1 - x_ + x2*y + x3*z)^2 + abs(x*x4 - y_ + x5*y + x6*z)^2 + abs(x*x7 - z_ + x8*y + x9*z)^2);
%  2*conj(sign(x*x4 - y_ + x5*y + x6*z))*abs(x*x4 - y_ + x5*y + x6*z)*conj(z)*(abs(x*x1 - x_ + x2*y + x3*z)^2 + abs(x*x4 - y_ + x5*y + x6*z)^2 + abs(x*x7 - z_ + x8*y + x9*z)^2);
%  2*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x7 - z_ + x8*y + x9*z)*conj(x)*(abs(x*x1 - x_ + x2*y + x3*z)^2 + abs(x*x4 - y_ + x5*y + x6*z)^2 + abs(x*x7 - z_ + x8*y + x9*z)^2);
%  2*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x7 - z_ + x8*y + x9*z)*conj(y)*(abs(x*x1 - x_ + x2*y + x3*z)^2 + abs(x*x4 - y_ + x5*y + x6*z)^2 + abs(x*x7 - z_ + x8*y + x9*z)^2);
%  2*conj(sign(x*x7 - z_ + x8*y + x9*z))*abs(x*x7 - z_ + x8*y + x9*z)*conj(z)*(abs(x*x1 - x_ + x2*y + x3*z)^2 + abs(x*x4 - y_ + x5*y + x6*z)^2 + abs(x*x7 - z_ + x8*y + x9*z)^2)]; % J'f


%% syms transform into function
F =  @(x,x1,x2,x3,x4,x5,x6,x7,x8,x9,x_,y,y_,z,z_) abs(-x_+x.*x1+x2.*y+x3.*z).^2+abs(-y_+x.*x4+x5.*y+x6.*z).^2+abs(-z_+x.*x7+x8.*y+x9.*z).^2; 
A =  @(x,x1,x2,x3,x4,x5,x6,x7,x8,x9,x_,y,y_,z,z_) reshape([x.*abs(-x_+x.*x1+x2.*y+x3.*z).^2.*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(x).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,x.*abs(-x_+x.*x1+x2.*y+x3.*z).^2.*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(y).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,x.*abs(-x_+x.*x1+x2.*y+x3.*z).^2.*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(z).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,x.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-y_+x.*x4+x5.*y+x6.*z).*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(x).*4.0,x.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-y_+x.*x4+x5.*y+x6.*z).*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(y).*4.0,x.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-y_+x.*x4+x5.*y+x6.*z).*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(z).*4.0,x.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(x).*4.0,x.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(y).*4.0,x.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(z).*4.0,y.*abs(-x_+x.*x1+x2.*y+x3.*z).^2.*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(x).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,y.*abs(-x_+x.*x1+x2.*y+x3.*z).^2.*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(y).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,y.*abs(-x_+x.*x1+x2.*y+x3.*z).^2.*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(z).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,y.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-y_+x.*x4+x5.*y+x6.*z).*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(x).*4.0,y.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-y_+x.*x4+x5.*y+x6.*z).*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(y).*4.0,y.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-y_+x.*x4+x5.*y+x6.*z).*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(z).*4.0,y.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(x).*4.0,y.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(y).*4.0,y.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(z).*4.0,z.*abs(-x_+x.*x1+x2.*y+x3.*z).^2.*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(x).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,z.*abs(-x_+x.*x1+x2.*y+x3.*z).^2.*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(y).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,z.*abs(-x_+x.*x1+x2.*y+x3.*z).^2.*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(z).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,z.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-y_+x.*x4+x5.*y+x6.*z).*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(x).*4.0,z.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-y_+x.*x4+x5.*y+x6.*z).*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(y).*4.0,z.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-y_+x.*x4+x5.*y+x6.*z).*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(z).*4.0,z.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(x).*4.0,z.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(y).*4.0,z.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-x_+x.*x1+x2.*y+x3.*z).*conj(z).*4.0,x.*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-y_+x.*x4+x5.*y+x6.*z).*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(x).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,x.*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-y_+x.*x4+x5.*y+x6.*z).*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(y).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,x.*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-y_+x.*x4+x5.*y+x6.*z).*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(z).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,x.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).^2.*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(x).*4.0,x.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).^2.*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(y).*4.0,x.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).^2.*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(z).*4.0,x.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(x).*4.0,x.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(y).*4.0,x.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(z).*4.0,y.*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-y_+x.*x4+x5.*y+x6.*z).*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(x).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,y.*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-y_+x.*x4+x5.*y+x6.*z).*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(y).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,y.*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-y_+x.*x4+x5.*y+x6.*z).*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(z).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,y.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).^2.*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(x).*4.0,y.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).^2.*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(y).*4.0,y.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).^2.*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(z).*4.0,y.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(x).*4.0,y.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(y).*4.0,y.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(z).*4.0,z.*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-y_+x.*x4+x5.*y+x6.*z).*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(x).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,z.*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-y_+x.*x4+x5.*y+x6.*z).*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(y).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,z.*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-y_+x.*x4+x5.*y+x6.*z).*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(z).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,z.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).^2.*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(x).*4.0,z.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).^2.*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(y).*4.0,z.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).^2.*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(z).*4.0,z.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(x).*4.0,z.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(y).*4.0,z.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-y_+x.*x4+x5.*y+x6.*z).*conj(z).*4.0,x.*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(x).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,x.*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(y).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,x.*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(z).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,x.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(x).*4.0,x.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(y).*4.0,x.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(z).*4.0,x.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-z_+x.*x7+x8.*y+x9.*z).^2.*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(x).*4.0,x.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-z_+x.*x7+x8.*y+x9.*z).^2.*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(y).*4.0,x.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-z_+x.*x7+x8.*y+x9.*z).^2.*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(z).*4.0,y.*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(x).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,y.*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(y).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,y.*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(z).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,y.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(x).*4.0,y.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(y).*4.0,y.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(z).*4.0,y.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-z_+x.*x7+x8.*y+x9.*z).^2.*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(x).*4.0,y.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-z_+x.*x7+x8.*y+x9.*z).^2.*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(y).*4.0,y.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-z_+x.*x7+x8.*y+x9.*z).^2.*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(z).*4.0,z.*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(x).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,z.*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(y).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,z.*abs(-x_+x.*x1+x2.*y+x3.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(z).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*4.0,z.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(x).*4.0,z.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(y).*4.0,z.*conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*abs(-z_+x.*x7+x8.*y+x9.*z).*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(z).*4.0,z.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-z_+x.*x7+x8.*y+x9.*z).^2.*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(x).*4.0,z.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-z_+x.*x7+x8.*y+x9.*z).^2.*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(y).*4.0,z.*conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-z_+x.*x7+x8.*y+x9.*z).^2.*sign(-z_+x.*x7+x8.*y+x9.*z).*conj(z).*4.0],[9,9]);
g =  @(x,x1,x2,x3,x4,x5,x6,x7,x8,x9,x_,y,y_,z,z_) [abs(-x_+x.*x1+x2.*y+x3.*z).*conj(x).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*(abs(-x_+x.*x1+x2.*y+x3.*z).^2+abs(-y_+x.*x4+x5.*y+x6.*z).^2+abs(-z_+x.*x7+x8.*y+x9.*z).^2).*2.0;abs(-x_+x.*x1+x2.*y+x3.*z).*conj(y).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*(abs(-x_+x.*x1+x2.*y+x3.*z).^2+abs(-y_+x.*x4+x5.*y+x6.*z).^2+abs(-z_+x.*x7+x8.*y+x9.*z).^2).*2.0;abs(-x_+x.*x1+x2.*y+x3.*z).*conj(z).*conj(sign(-x_+x.*x1+x2.*y+x3.*z)).*(abs(-x_+x.*x1+x2.*y+x3.*z).^2+abs(-y_+x.*x4+x5.*y+x6.*z).^2+abs(-z_+x.*x7+x8.*y+x9.*z).^2).*2.0;conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*conj(x).*(abs(-x_+x.*x1+x2.*y+x3.*z).^2+abs(-y_+x.*x4+x5.*y+x6.*z).^2+abs(-z_+x.*x7+x8.*y+x9.*z).^2).*2.0;conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*conj(y).*(abs(-x_+x.*x1+x2.*y+x3.*z).^2+abs(-y_+x.*x4+x5.*y+x6.*z).^2+abs(-z_+x.*x7+x8.*y+x9.*z).^2).*2.0;conj(sign(-y_+x.*x4+x5.*y+x6.*z)).*abs(-y_+x.*x4+x5.*y+x6.*z).*conj(z).*(abs(-x_+x.*x1+x2.*y+x3.*z).^2+abs(-y_+x.*x4+x5.*y+x6.*z).^2+abs(-z_+x.*x7+x8.*y+x9.*z).^2).*2.0;conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-z_+x.*x7+x8.*y+x9.*z).*conj(x).*(abs(-x_+x.*x1+x2.*y+x3.*z).^2+abs(-y_+x.*x4+x5.*y+x6.*z).^2+abs(-z_+x.*x7+x8.*y+x9.*z).^2).*2.0;conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-z_+x.*x7+x8.*y+x9.*z).*conj(y).*(abs(-x_+x.*x1+x2.*y+x3.*z).^2+abs(-y_+x.*x4+x5.*y+x6.*z).^2+abs(-z_+x.*x7+x8.*y+x9.*z).^2).*2.0;conj(sign(-z_+x.*x7+x8.*y+x9.*z)).*abs(-z_+x.*x7+x8.*y+x9.*z).*conj(z).*(abs(-x_+x.*x1+x2.*y+x3.*z).^2+abs(-y_+x.*x4+x5.*y+x6.*z).^2+abs(-z_+x.*x7+x8.*y+x9.*z).^2).*2.0];

%% initial value
X = rand(9,1);%initial weight
tau = 1e-10; %initial parameter
e = 1e-13; %deformate error
k = 0;
v = 2;
I = diag(ones(1,9));
mu = tau*max(diag(A(Y_pred(1),X(1,1),X(2,1),X(3,1),X(4,1),X(5,1),X(6,1),X(7,1),X(8,1),X(9,1),Y_gt(1),Y_pred(2),Y_gt(2),Y_pred(3),Y_gt(3)))); 


%% Main Loop
while k<1000
    k = k+1;
    h = inv(A(Y_pred(1),X(1,1),X(2,1),X(3,1),X(4,1),X(5,1),X(6,1),X(7,1),X(8,1),X(9,1),Y_gt(1),Y_pred(2),Y_gt(2),Y_pred(3),Y_gt(3))+mu.*I)*-g(Y_pred(1), X(1,1),X(2,1),X(3,1),X(4,1),X(5,1),X(6,1),X(7,1),X(8,1),X(9,1),Y_gt(1),Y_pred(2),Y_gt(2),Y_pred(3),Y_gt(3)); %it can be changed to (A+mu*I)/-g but I didnt have a try
    if norm(h)<e*(norm(X)+h)
       break;
    else
        X_new = X + h;
        rho = (F(Y_pred(1), X(1,1),X(2,1),X(3,1),X(4,1),X(5,1),X(6,1),X(7,1),X(8,1),X(9,1),Y_gt(1),Y_pred(2),Y_gt(2),Y_pred(3),Y_gt(3))-F(Y_pred(1), X_new(1,1),X_new(2,1),X_new(3,1),X_new(4,1),X_new(5,1),X_new(6,1),X_new(7,1),X_new(8,1),X_new(9,1),Y_gt(1),Y_pred(2),Y_gt(2),Y_pred(3),Y_gt(3)))...
            /(0.5*h'*(mu*h-g(Y_pred(1),X(1,1),X(2,1),X(3,1),X(4,1),X(5,1),X(6,1),X(7,1),X(8,1),X(9,1),Y_gt(1),Y_pred(2),Y_gt(2),Y_pred(3),Y_gt(3))));
        if rho > 0
            X = X_new;
            mu = mu*max(1/3, 1-(2*rho-1).^3);
            v = 2;
        else
            mu = mu*v;
            v = 2*v;
        end
    end   
end
Transform_matrix = [X(1,1),X(2,1),X(3,1);X(4,1),X(5,1),X(6,1);X(7,1),X(8,1),X(9,1)];
Error = F(Y_pred(1), X(1,1),X(2,1),X(3,1),X(4,1),X(5,1),X(6,1),X(7,1),X(8,1),X(9,1),Y_gt(1),Y_pred(2),Y_gt(2),Y_pred(3),Y_gt(3));
end